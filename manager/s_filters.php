<?phpinclude "../common/common.php";if(!userIsOk()){redirTo("login.php");}//checking userif(isset($_GET["action"])){        if($_GET["action"]=="delete-group"){        $id = (int)$_GET["id"];				$db->query("Delete from shop_filters_x_products fx inner join shop_filters sf on fx.shop_filter_id = sf.id where sf.filter_group_id=$id");        $db->query("Delete from shop_filter_groups where id=$id");        $db->query("Delete from shop_filters where filter_group_id=$id");        $db->query("optimize table shop_filters_x_products, shop_filter_groups, shop_filters;");		        $_SESSION["response_msg"] = "Grupul de filtre, filtrele si toate legaturile cu produsele au fost sterss!";  		        redirTo("s_filters.php");    }		if($_GET["action"]=="delete-filter"){        $id = (int)$_GET["filter_id"];		        $db->query("Delete from shop_filters where id=$id");        $db->query("Delete from shop_filters_x_products where shop_filter_id=$id");		$db->query("optimize table shop_filters_x_products, shop_filters;");		        $_SESSION["response_msg"] = "Filtrul si toate legaturile cu produsele au fost sterse!";  		        redirTo("s_filters.php");    }        if($_GET["action"]=="addnew-group"){		if(trim($_POST['group_name']) != "") {			$group     = mysql_real_escape_string($_POST["group_name"]);			$group_url = text_to_url($group);										$db->query("Insert into shop_filter_groups (group_name, group_slug) values ('$group', '$group_url')");			$id = $db->lastId;						$_SESSION["response_msg"] = "Noul grup de filtre a fost adaugat!";						redirTo("s_filters.php");		} else {			$_SESSION["response_msg"] = "Campul 'Nume Grup' nu a fost completat!";		}    }		if($_GET["action"]=="addnew-filter"){		if(trim($_POST['filter_name']) != "" && (int) $_POST['group_id'] > 0) {			$filter_name     = mysql_real_escape_string($_POST["filter_name"]);			$filter_name_url = text_to_url($filter_name);			$group_id        = (int) $_POST['group_id']; 										$db->query("Insert into shop_filters (filter_group_id, filter_name, filter_slug) values ('$group_id', '$filter_name', '$filter_name_url')");			$id = $db->lastId;						$_SESSION["response_msg"] = "Noul filtru a fost adaugat!";						redirTo("s_filters.php");		} else {			$_SESSION["response_msg"] = "Completati campurile 'Grup' si 'Nume filtru'!";		}    }}//datagrid includeinclude ("include/class.datagrid.php");$myDG = new DataGrid($db);$myDGF = new DataGrid($db);parseClassDep2IncludeFile ("include/",$myDG->getDependencies());$curPage = 1;if(isset($_GET["curPage"])){$curPage = (int)$_GET["curPage"];if($curPage==0){$curPage = 1;}}//jHtmlArea js and css includeaddSuplementalIncludeFile("js/jHtmlArea-0.7.0.min.js","js");addSuplementalIncludeFile("css/jHtmlArea.css","css");$page_name = "s_filters";$page_title = "Filtre";include "include/header.php";?><p><a href="javascript:void(0)" onclick="$('#addnew_group').fadeIn('normal')">Adauga un nou grup de filtre &raquo;</a></p><p><a href="javascript:void(0)" onclick="$('#addnew_filter').fadeIn('normal')">Adauga un nou filtru &raquo;</a></p><div class="spacer5"></div><div id="addnew_group" class="form-container">	<div class="form-title">Adauga un grup de filtre</div>	<p><small>Ex.: Producator, Dimensiuni ecran, Sistem de operare</small></p>		<form name="addnew_group" id="addnew_group-form" method="post" action="s_filters.php?action=addnew-group" onsubmit="if(!validateForm(arFieldsGroup, 'error-holder')){return false}">		<div class="form_item">			<label for="group_name">Nume grup</label>			<input type="text" name="group_name" id="group_name" value="" class="txt">			<div class="clear"></div>		</div>				<div class="form_item">        			<div class="spacer10"></div>						<script language="javascript">				//validation rules				var arFieldsGroup = new Array();				var arField = new Array("Nume grup", "group_name", "required"); arFieldsGroup[1] = arField;                    			</script>						<a href="javascript:void(0)" onclick="if(validateForm(arFieldsGroup, 'error-holder')){$('#addnew_group-form').submit();}" class="button"><span>Adauga</span></a>			<a href="javascript:void(0)" onclick="$('#addnew_group').fadeOut('fast'); $('#error-holder').hide();" class="button"><span class="normal">Renunta</span></a>			<input type="submit" name="cmdSubmitGroup" value="" style="width: 0px; height: 0px; border: 0px; margin: 0px; padding: 0px;">			<div class="clear"></div>		</div>				<div class="form_item">        			<label>&nbsp;</label>			<div id="error-holder" style="display: none;"></div>			<div class="clear"></div>		</div>	</form></div><div id="addnew_filter" class="form-container">	<div class="form-title">Adauga un filtru</div>	<p><small>Ex.: sistem de operare: Android, Symbian, WindowsPhone, IOS</small></p>		<form name="addnew_filter" id="addnew_filter-form" method="post" action="s_filters.php?action=addnew-filter" onsubmit="if(!validateForm(arFieldsFilters, 'error-holder')){return false}">		<div class="form_item">			<label for="group_id">Grup</label>			<select name="group_id" id="group_id">				<?php				$gp = $db->get_results("Select * from shop_filter_groups order by id asc");				if($gp!=null){					foreach ($gp as $g){						?>						<option value="<?php echo $g->id; ?>"><?php echo $g->group_name; ?></option>						<?php					}				}				?>			</select>   			<div class="clear"></div>		</div>				<div class="form_item">			<label for="group_name">Nume filtru</label>			<input type="text" name="filter_name" id="filter_name" value="" class="txt">			<div class="clear"></div>		</div>				<div class="form_item">        			<div class="spacer10"></div>						<script language="javascript">				//validation rules				var arFieldsFilters = new Array();				var arField = new Array("Nume filtru", "filter_name", "required"); arFieldsFilters[1] = arField;                    				var arField = new Array("Grup", "group_id", "required"); arFieldsFilters[2] = arField;                    			</script>						<a href="javascript:void(0)" onclick="if(validateForm(arFieldsFilters, 'error-holder')){$('#addnew_filter-form').submit();}" class="button"><span>Adauga</span></a>			<a href="javascript:void(0)" onclick="$('#addnew_filter').fadeOut('fast'); $('#error-holder').hide();" class="button"><span class="normal">Renunta</span></a>			<input type="submit" name="cmdSubmitFilter" value="" style="width: 0px; height: 0px; border: 0px; margin: 0px; padding: 0px;">			<div class="clear"></div>		</div>				<div class="form_item">        			<label>&nbsp;</label>			<div id="error-holder" style="display: none;"></div>			<div class="clear"></div>		</div>	</form></div><script type="text/javascript">$(function(){    $('#addnew_group').hide();    $('#addnew_filter').hide();});</script><hr/><div class="spacer10"></div><h2>Grupuri de filtre</h2><?php$myDG->setSqlString ("Select * from shop_filter_groups order by id");$myDG->setSqlCountString ("Select count(*) shop_filter_groups");$myDG->setIdField("id");$myDG->setSelfLink("s_filters.php?");$myDG->setCurrentPage($curPage);$myDG->setRecPerPage(20);//adding columns$myDG->addColumn ('#', '', 'counter', '30px');$myDG->addColumn ('Grup de filtre', '#|group_name|#', 'field', '200px', 'left');$myDG->addColumn ('Slug grup', '#|group_slug|#', 'field', '200px', 'left');$myDG->addColumn ('Optiuni', '', 'options');//adding options#$myDG->addOption ('editeaza', 'images/edit.gif', 'sd_partners.php?action=edit#replace#', 'html');$myDG->addOption ('editeaza', 'images/edit.gif', 'editPopup2(\'popup_edit.php?what=filter-group#replace#\');', 'js');$myDG->addOption ('sterge', 'images/delete.gif', 'ConfirmDelete2Link(\'s_filters.php?action=delete-group#replace#\');', 'js');//draw$myDG->Draw();?><hr/><div class="spacer10"></div><h2>Filtre produse</h2><?php$myDGF->setSqlString ("			SELECT f.id AS 'filter_id', f.filter_name, f.filter_slug, fg.group_name, fg.id AS 'group_id'			FROM `shop_filters` f			INNER JOIN shop_filter_groups fg ON f.filter_group_id = fg.id			ORDER BY group_id		");$myDGF->setSqlCountString ("			SELECT count(*)			FROM `shop_filters` f			INNER JOIN shop_filter_groups fg ON f.filter_group_id = fg.id");$myDGF->setIdField("filter_id");$myDGF->setSelfLink("s_filters.php?");$myDGF->setCurrentPage($curPage);$myDGF->setRecPerPage(20);//adding columns$myDGF->addColumn ('#', '', 'counter', '30px');$myDGF->addColumn ('Nume filtru', '#|filter_name|#', 'field', '400px', 'left');$myDGF->addColumn ('Slug filtru', '#|filter_slug|#', 'field', '200px', 'left');$myDGF->addColumn ('Grup de filtre', '#|group_name|#', 'field', '250px', 'left');$myDGF->addColumn ('Optiuni', '', 'options');//adding options#$myDG->addOption ('editeaza', 'images/edit.gif', 'sd_partners.php?action=edit#replace#', 'html');$myDGF->addOption ('editeaza', 'images/edit.gif', 'editPopup2(\'popup_edit.php?what=filter#replace#\');', 'js');$myDGF->addOption ('sterge', 'images/delete.gif', 'ConfirmDelete2Link(\'s_filters.php?action=delete-filter#replace#\');', 'js');//draw$myDGF->Draw();?><?phpinclude "include/footer.php";?>